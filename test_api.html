<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TNP Accounting API Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section.success {
            border-color: #4caf50;
            background: #f8fff8;
        }
        .test-section.error {
            border-color: #f44336;
            background: #fff8f8;
        }
        button {
            background: #900F0F;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #B20000;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .success-status { color: #4caf50; }
        .error-status { color: #f44336; }
        .loading-status { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ TNP Accounting API Test Tool</h1>
        <p>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö TNP Accounting</p>
        
        <button onclick="testAllAPIs()">üöÄ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button onclick="clearResults()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api/v1';
        
        async function makeRequest(url, method = 'GET') {
            try {
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        function createTestSection(title, status, content) {
            const section = document.createElement('div');
            section.className = `test-section ${status}`;
            section.innerHTML = `
                <div class="status ${status}-status">${title}</div>
                <pre>${content}</pre>
            `;
            return section;
        }
        
        async function testDashboardStats() {
            updateStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Dashboard Stats API...');
            const result = await makeRequest(`${API_BASE_URL}/dashboard/stats`);
            
            const resultsDiv = document.getElementById('results');
            const content = result.success 
                ? JSON.stringify(result.data, null, 2)
                : `Error: ${result.error || result.data?.message || 'Unknown error'}`;
            
            const status = result.success ? 'success' : 'error';
            const title = `1Ô∏è‚É£ Dashboard Stats API - ${result.success ? '‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'}`;
            
            resultsDiv.appendChild(createTestSection(title, status, content));
        }
        
        async function testPricingRequests() {
            updateStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Pricing Requests API...');
            const result = await makeRequest(`${API_BASE_URL}/pricing-requests`);
            
            const resultsDiv = document.getElementById('results');
            let content;
            
            if (result.success) {
                const data = result.data?.data;
                const totalRecords = data?.pagination?.total || 0;
                const dataCount = data?.data?.length || 0;
                
                content = `‚úÖ API ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥
üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalRecords}
üìã ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${dataCount}

üìÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:
${JSON.stringify(result.data, null, 2)}`;
            } else {
                content = `‚ùå Error: ${result.error || result.data?.message || 'Unknown error'}
Status: ${result.status || 'Unknown'}

üìÑ Response:
${JSON.stringify(result.data, null, 2)}`;
            }
            
            const status = result.success ? 'success' : 'error';
            const title = `2Ô∏è‚É£ Pricing Requests API - ${result.success ? '‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'}`;
            
            resultsDiv.appendChild(createTestSection(title, status, content));
            
            return result.success ? result.data?.data?.data : null;
        }
        
        async function testPricingAutofill(pricingData) {
            if (!pricingData || pricingData.length === 0) {
                const resultsDiv = document.getElementById('results');
                resultsDiv.appendChild(createTestSection(
                    '3Ô∏è‚É£ Pricing Request Autofill API - ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                    'error',
                    '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Pricing Request ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö Autofill API'
                ));
                return;
            }
            
            const prId = pricingData[0].pr_id;
            updateStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Pricing Request Autofill API (ID: ${prId})...`);
            
            const result = await makeRequest(`${API_BASE_URL}/pricing-requests/${prId}/autofill`);
            
            const resultsDiv = document.getElementById('results');
            const content = result.success 
                ? JSON.stringify(result.data, null, 2)
                : `Error: ${result.error || result.data?.message || 'Unknown error'}`;
            
            const status = result.success ? 'success' : 'error';
            const title = `3Ô∏è‚É£ Pricing Request Autofill API (ID: ${prId}) - ${result.success ? '‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'}`;
            
            resultsDiv.appendChild(createTestSection(title, status, content));
        }
        
        async function testAllAPIs() {
            clearResults();
            updateStatus('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö API...');
            
            // Test 1: Dashboard Stats
            await testDashboardStats();
            
            // Test 2: Pricing Requests
            const pricingData = await testPricingRequests();
            
            // Test 3: Pricing Autofill
            await testPricingAutofill(pricingData);
            
            updateStatus('üèÅ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!');
        }
        
        function updateStatus(message) {
            const existingStatus = document.getElementById('status');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            const statusDiv = document.createElement('div');
            statusDiv.id = 'status';
            statusDiv.className = 'status loading-status';
            statusDiv.textContent = message;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.appendChild(statusDiv);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Auto-test on page load
        window.addEventListener('load', () => {
            setTimeout(testAllAPIs, 1000);
        });
    </script>
</body>
</html>
